/*!
 * @license :@maticnetwork/maticjs - V3.6.0-beta.3 - 31/01/2023
 * https://github.com/maticnetwork/matic.js
 * Copyright (c) 2023 @polygon; Licensed MIT
 */
module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=7)}([function(t,e){t.exports=require("ethereumjs-util")},function(t,e,r){
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var n=r(5),o=n.Buffer;function i(t,e){for(var r in t)e[r]=t[r]}function a(t,e,r){return o(t,e,r)}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?t.exports=n:(i(n,e),e.Buffer=a),a.prototype=Object.create(o.prototype),i(o,a),a.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return o(t,e,r)},a.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=o(t);return void 0!==e?"string"==typeof r?n.fill(e,r):n.fill(e):n.fill(0),n},a.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return o(t)},a.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},function(t,e){t.exports=require("@ethereumjs/common")},function(t,e){t.exports=require("merkle-patricia-tree")},function(t,e){t.exports=require("@ethereumjs/block")},function(t,e){t.exports=require("buffer")},function(t,e){t.exports=require("node-fetch")},function(t,e,r){"use strict";r.r(e),r.d(e,"use",(function(){return d})),r.d(e,"eventBusPromise",(function(){return g})),r.d(e,"EventBus",(function(){return y})),r.d(e,"Logger",(function(){return v})),r.d(e,"merge",(function(){return b})),r.d(e,"mapPromise",(function(){return P})),r.d(e,"ProofUtil",(function(){return S})),r.d(e,"HttpRequest",(function(){return M})),r.d(e,"Converter",(function(){return H})),r.d(e,"Web3SideChainClient",(function(){return D})),r.d(e,"BaseToken",(function(){return V})),r.d(e,"setProofApi",(function(){return $})),r.d(e,"setHermezProofApi",(function(){return tt})),r.d(e,"resolve",(function(){return et})),r.d(e,"promiseResolve",(function(){return W})),r.d(e,"promiseAny",(function(){return U})),r.d(e,"BridgeClient",(function(){return rt})),r.d(e,"ABIManager",(function(){return ot})),r.d(e,"throwNotImplemented",(function(){return it})),r.d(e,"HermezBridgeClient",(function(){return at})),r.d(e,"utils",(function(){return ct})),r.d(e,"Log_Event_Signature",(function(){return o})),r.d(e,"ERROR_TYPE",(function(){return i})),r.d(e,"ExitUtil",(function(){return gt})),r.d(e,"RootChainManager",(function(){return lt})),r.d(e,"RootChain",(function(){return bt})),r.d(e,"POSClient",(function(){return Bt})),r.d(e,"MAX_AMOUNT",(function(){return L})),r.d(e,"ADDRESS_ZERO",(function(){return z})),r.d(e,"DAI_PERMIT_TYPEHASH",(function(){return q})),r.d(e,"EIP_2612_PERMIT_TYPEHASH",(function(){return G})),r.d(e,"EIP_2612_DOMAIN_TYPEHASH",(function(){return Z})),r.d(e,"UNISWAP_DOMAIN_TYPEHASH",(function(){return Y})),r.d(e,"Permit",(function(){return C})),r.d(e,"BaseContractMethod",(function(){return a})),r.d(e,"BaseWeb3Client",(function(){return c})),r.d(e,"BaseContract",(function(){return s})),r.d(e,"BaseBigNumber",(function(){return u})),r.d(e,"NetworkService",(function(){return K})),r.d(e,"service",(function(){return Q})),r.d(e,"HermezBridge",(function(){return St})),r.d(e,"BridgeUtil",(function(){return jt})),r.d(e,"HermezClient",(function(){return Ht}));var n,o,i,a=function(t){this.logger=t},c=function(){function t(t){this.logger=t}return t.prototype.getRootHash=function(t,e){return this.sendRPCRequest({jsonrpc:"2.0",method:"eth_getRootHash",params:[Number(t),Number(e)],id:(new Date).getTime()}).then((function(t){return String(t.result)}))},t.prototype.getAccountsUsingRPC_=function(){return this.sendRPCRequest({jsonrpc:"2.0",method:"eth_accounts",params:[],id:(new Date).getTime()}).then((function(t){return t.result}))},t}(),s=function(t,e){this.address=t,this.logger=e},u=function(){function t(){}return t.isBN=function(t){return it()},t}(),f=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),h=function(t){function e(e){return t.call(this)||this}return f(e,t),e.prototype.toString=function(t){return it()},e.prototype.toNumber=function(){return it()},e.prototype.toBuffer=function(t){return it()},e.prototype.add=function(t){return it()},e.prototype.sub=function(t){return it()},e.prototype.mul=function(t){return it()},e.prototype.div=function(t){return it()},e.prototype.lte=function(t){return it()},e.prototype.lt=function(t){return it()},e.prototype.gte=function(t){return it()},e.prototype.gt=function(t){return it()},e.prototype.eq=function(t){return it()},e}(u),p=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},d=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n="function"==typeof t?new t:t;return n.setup.apply(n,p([At],e,!1))},l=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},g=function(t){var e=new Promise(t),r=new y;return e.on=r.on.bind(r),e.emit=r.emit.bind(r),e},y=function(){function t(t){this._events={},this._ctx=t}return t.prototype.on=function(t,e){return null==this._events[t]&&(this._events[t]=[]),this._events[t].push(e),this},t.prototype.off=function(t,e){if(this._events[t])if(e){var r=this._events[t].indexOf(e);this._events[t].splice(r,1)}else this._events[t]=[]},t.prototype.emit=function(t){for(var e=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=this._events[t]||[];return Promise.all(o.map((function(t){var n=t.call.apply(t,l([e._ctx],r,!1));return n&&n.then?n:Promise.resolve(n)})))},t.prototype.destroy=function(){this._events=null,this._ctx=null},t}();!function(t){t.Erc20Transfer="0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",t.Erc721Transfer="0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",t.Erc1155Transfer="0xc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62",t.Erc721BatchTransfer="0xf871896b17e9cb7a64941c62c188a4f5c621b86800e3d15452ece01ce56073df",t.Erc1155BatchTransfer="0x4a39dc06d4c0dbc64b70af90fd698a233a518aa5d07e595d983b8c0526c8f7fb",t.Erc721TransferWithMetadata="0xf94915c6d1fd521cee85359239227480c7e8776d7caf1fc3bacad5c269b66a14"}(o||(o={})),function(t){t.AllowedOnRoot="allowed_on_root",t.AllowedOnChild="allowed_on_child",t.Unknown="unknown",t.ProofAPINotSet="proof_api_not_set",t.TransactionOptionNotObject="transation_object_not_object",t.BurnTxNotCheckPointed="burn_tx_not_checkpointed",t.EIP1559NotSupported="eip-1559_not_supported",t.NullSpenderAddress="null_spender_address",t.AllowedOnNonNativeTokens="allowed_on_non_native_token"}(i||(i={}));var m=function(){function t(t,e){this.type=t,this.message=this.getMsg_(e)}return t.prototype.throw=function(){throw this.get()},t.prototype.get=function(){return{message:this.message,type:this.type}},t.prototype.getMsg_=function(t){var e;switch(this.type){case i.AllowedOnChild:e="The action ".concat(t," is allowed only on child token.");break;case i.AllowedOnRoot:e="The action ".concat(t," is allowed only on root token.");break;case i.ProofAPINotSet:e='Proof api is not set, please set it using "setProofApi"';break;case i.BurnTxNotCheckPointed:e="Burn transaction has not been checkpointed as yet";break;case i.EIP1559NotSupported:e="".concat(t?"Root":"Child"," chain doesn't support eip-1559");break;case i.NullSpenderAddress:e="Please provide spender address.";break;default:this.type||(this.type=i.Unknown),e=this.message}return e},t}(),v=function(){function t(){}return t.prototype.enableLog=function(t){this.isEnabled=!!t},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.isEnabled&&console.log.apply(console,t)},t.prototype.error=function(t,e){return new m(t,e)},t}(),w=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},b=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Object.assign.apply(Object,w([{}],t,!1))};function P(t,e,r){void 0===r&&(r={});var n=t.length,o=r.concurrency||n,i=[],a=function(){return function(t,e){var r=t.map((function(t,r){return e(t,r)}));return Promise.all(r)}(t.splice(0,o),e).then((function(t){return i=i.concat(t),n>i.length?a():W(i)}))};return a()}var C,x=r(1),_=r(0),k=_.keccak256,B=function(){function t(t){if(void 0===t&&(t=[]),t.length<1)throw new Error("Atleast 1 leaf needed");var e=Math.ceil(Math.log(t.length)/Math.log(2));if(e>20)throw new Error("Depth must be 20 or less");this.leaves=t.concat(Array.from(Array(Math.pow(2,e)-t.length),(function(){return _.zeros(32)}))),this.layers=[this.leaves],this.createHashes(this.leaves)}return t.prototype.createHashes=function(t){if(1===t.length)return!1;for(var e=[],r=0;r<t.length;r+=2){var n=t[r],o=t[r+1],i=x.Buffer.concat([n,o]);e.push(k(i))}t.length%2==1&&e.push(t[t.length-1]),this.layers.push(e),this.createHashes(e)},t.prototype.getLeaves=function(){return this.leaves},t.prototype.getLayers=function(){return this.layers},t.prototype.getRoot=function(){return this.layers[this.layers.length-1][0]},t.prototype.getProof=function(t){for(var e=-1,r=0;r<this.leaves.length;r++)0===x.Buffer.compare(t,this.leaves[r])&&(e=r);var n=[];if(e<=this.getLeaves().length){var o=void 0;for(r=0;r<this.layers.length-1;r++)o=e%2==0?e+1:e-1,e=Math.floor(e/2),n.push(this.layers[r][o])}return n},t.prototype.verify=function(t,e,r,n){if(!Array.isArray(n)||!t||!r)return!1;for(var o=t,i=0;i<n.length;i++){var a=n[i];o=k(e%2==0?x.Buffer.concat([o,a]):x.Buffer.concat([a,o])),e=Math.floor(e/2)}return 0===x.Buffer.compare(o,r)},t}(),A=r(0),E=r(3),O=r(4),T=r(2),R=r.n(T),I=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function c(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,c)}s((n=n.apply(t,e||[])).next())}))},N=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},S=function(){function t(){}return t.getFastMerkleProof=function(t,e,r,n){return I(this,void 0,void 0,(function(){var o,i,a,c,s,u,f,h,p;return N(this,(function(d){switch(d.label){case 0:o=Math.ceil(Math.log2(n-r+1)),i=[],c=e-(a=r),s=0,u=n-a,f=function(e){var r,n,f,p,d,l,g,y,m,v,w;return N(this,(function(b){switch(b.label){case 0:return r=Math.pow(2,o-e),c>(n=s+r/2-1)?(f=n+1,[4,h.queryRootHash(t,a+s,a+n)]):[3,2];case 1:return w=b.sent(),i.push(w),s=f,[3,6];case 2:return p=Math.min(u,n),d=o-(e+1),u<=n?(w=h.recursiveZeroHash(d,t),i.push(w),[3,5]):[3,3];case 3:return l=Math.ceil(Math.log2(u-n)),g=d-l,[4,h.queryRootHash(t,a+n+1,a+u)];case 4:y=b.sent(),m=h.recursiveZeroHash(l,t),(v=Array.from({length:Math.pow(2,g)},(function(){return Object(A.toBuffer)(m)})))[0]=y,w=new B(v).getRoot(),i.push(w),b.label=5;case 5:u=p,b.label=6;case 6:return[2]}}))},h=this,p=0,d.label=1;case 1:return p<o?[5,f(p)]:[3,4];case 2:d.sent(),d.label=3;case 3:return p+=1,[3,1];case 4:return[2,i.reverse()]}}))}))},t.buildBlockProof=function(e,r,n,o){return t.getFastMerkleProof(e,o,r,n).then((function(t){return Object(A.bufferToHex)(Buffer.concat(t.map((function(t){return Object(A.toBuffer)(t)}))))}))},t.queryRootHash=function(t,e,r){return t.getRootHash(e,r).then((function(t){return Object(A.toBuffer)("0x".concat(t))})).catch((function(t){return null}))},t.recursiveZeroHash=function(t,e){if(0===t)return"0x0000000000000000000000000000000000000000000000000000000000000000";var r=this.recursiveZeroHash(t-1,e);return Object(A.keccak256)(Object(A.toBuffer)(e.encodeParameters([r,r],["bytes32","bytes32"])))},t.getReceiptProof=function(e,r,n,o,i){void 0===o&&(o=1/0);var a,c=Object(A.bufferToHex)(t.getStateSyncTxHash(r)),s=new E.BaseTrie;if(i)a=W(i);else{var u=[];r.transactions.forEach((function(t){t.transactionHash!==c&&u.push(n.getTransactionReceipt(t.transactionHash))})),a=P(u,(function(t){return t}),{concurrency:o})}return a.then((function(e){return Promise.all(e.map((function(e){var r=A.rlp.encode(e.transactionIndex),n=t.getReceiptBytes(e);return s.put(r,n)})))})).then((function(t){return s.findPath(A.rlp.encode(e.transactionIndex),!0)})).then((function(n){if(n.remaining.length>0)throw new Error("Node does not contain the key");return{blockHash:Object(A.toBuffer)(e.blockHash),parentNodes:n.stack.map((function(t){return t.raw()})),root:t.getRawHeader(r).receiptTrie,path:A.rlp.encode(e.transactionIndex),value:t.isTypedReceipt(e)?n.node.value:A.rlp.decode(n.node.value)}}))},t.isTypedReceipt=function(t){var e=H.toHex(t.type);return null!=t.status&&"0x0"!==e&&"0x"!==e},t.getStateSyncTxHash=function(t){return Object(A.keccak256)(Buffer.concat([Buffer.from("matic-bor-receipt-","utf-8"),Object(A.setLengthLeft)(Object(A.toBuffer)(t.number),8),Object(A.toBuffer)(t.hash)]))},t.getReceiptBytes=function(e){var r=A.rlp.encode([Object(A.toBuffer)(void 0!==e.status&&null!=e.status?e.status?"0x1":"0x":e.root),Object(A.toBuffer)(e.cumulativeGasUsed),Object(A.toBuffer)(e.logsBloom),e.logs.map((function(t){return[Object(A.toBuffer)(t.address),t.topics.map(A.toBuffer),Object(A.toBuffer)(t.data)]}))]);return t.isTypedReceipt(e)&&(r=Buffer.concat([Object(A.toBuffer)(e.type),r])),r},t.getRawHeader=function(t){t.difficulty=H.toHex(t.difficulty);var e=new R.a({chain:T.Chain.Mainnet,hardfork:T.Hardfork.London});return O.BlockHeader.fromHeaderData(t,{common:e})},t}(),j=r(6).default,M=function(){function t(t){void 0===t&&(t={}),this.baseUrl="",(t="string"==typeof t?{baseUrl:t}:t).baseUrl&&(this.baseUrl=t.baseUrl)}return t.prototype.get=function(t,e){return void 0===t&&(t=""),void 0===e&&(e={}),t=this.baseUrl+t+Object.keys(e).map((function(t){return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t]))})).join("&"),j(t,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((function(t){return t.json()}))},t.prototype.post=function(t,e){return void 0===t&&(t=""),t=this.baseUrl+t,j(t,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:e?JSON.stringify(e):null}).then((function(t){return t.json()}))},t}(),H=function(){function t(){}return t.toHex=function(t){var e=typeof t;if("number"===e)t=new ct.BN(t);else if("string"===e){if("0x"===t.slice(0,2))return t;t=new ct.BN(t)}if(ct.BN.isBN(t))return"0x"+t.toString(16);throw new Error("Invalid value ".concat(t,", value is not a number."))},t}(),F={1:"Main",5:"Main",137:"Matic",80001:"Matic",1422:"Hermez"},D=function(){function t(){this.logger=new v}return t.prototype.init=function(t){(t=t||{}).parent.defaultConfig=t.parent.defaultConfig||{},t.child.defaultConfig=t.child.defaultConfig||{},this.config=t;var e=ct.Web3Client;if(!e)throw new Error("Web3Client is not set");ct.UnstoppableDomains&&(this.resolution=ct.UnstoppableDomains),this.parent=new e(t.parent.provider,this.logger),this.child=new e(t.child.provider,this.logger),this.logger.enableLog(t.log);var r=t.network,n=t.version,o=this.abiManager=new ot(r,n);return this.logger.log("init called",o),o.init().catch((function(t){throw new Error("network ".concat(r," - ").concat(n," is not supported"))}))},t.prototype.getABI=function(t,e){return this.abiManager.getABI(t,e)},t.prototype.getConfig=function(t){return this.abiManager.getConfig(t)},Object.defineProperty(t.prototype,"mainPlasmaContracts",{get:function(){return this.getConfig("Main.Contracts")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mainPOSContracts",{get:function(){return this.getConfig("Main.POSContracts")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mainHermezContracts",{get:function(){return this.getConfig("Main.Contracts")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hermezContracts",{get:function(){return this.getConfig("zkEVM.Contracts")},enumerable:!1,configurable:!0}),t.prototype.isEIP1559Supported=function(t){return this.getConfig("".concat(F[t],".SupportsEIP1559"))},t}(),W=function(t){return Promise.resolve(t)},U=function(t){var e=new Array(t.length),r=0;return new Promise((function(n,o){t.forEach((function(i){Promise.resolve(i).then(n).catch((function(n){e[r]=n,(r+=1)===t.length&&o(e)}))}))}))},L="0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",z="0x0000000000000000000000000000000000000000",q="0xea2aa0a1be11a07ed86d755c93467f4f82362b452371d1ba94d1715123511acb",G="0x6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c9",Z="0x8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f",Y="0x8cad95687ba82c2ce50e74f7b754645e5117c3a5bec8151c0726d5857980a866";!function(t){t.DAI="DAI",t.EIP_2612="EIP_2612",t.UNISWAP="UNISWAP"}(C||(C={}));var V=function(){function t(t,e){this.contractParam=t,this.client=e}return Object.defineProperty(t.prototype,"contractAddress",{get:function(){return this.contractParam.address},enumerable:!1,configurable:!0}),t.prototype.getContract=function(){var t=this;if(this.contract_)return W(this.contract_);var e=this.contractParam;return this.client.getABI(e.name,e.bridgeType).then((function(r){return t.contract_=t.getContract_({abi:r,isParent:e.isParent,tokenAddress:e.address}),t.contract_}))},t.prototype.getChainId=function(){var t=this;return this.chainId_?W(this.chainId_):this.getClient(this.contractParam.isParent).getChainId().then((function(e){return t.chainId_=e,t.chainId_}))},t.prototype.processWrite=function(t,e){var r=this;return void 0===e&&(e={}),this.validateTxOption_(e),this.client.logger.log("process write"),this.createTransactionConfig({txConfig:e,isWrite:!0,method:t,isParent:this.contractParam.isParent}).then((function(n){return r.client.logger.log("process write config"),e.returnTransaction?b(n,{data:t.encodeABI(),to:t.address}):t.write(n)}))},t.prototype.sendTransaction=function(t){void 0===t&&(t={}),this.validateTxOption_(t);var e=this.contractParam.isParent,r=this.getClient(e);return r.logger.log("process write"),this.createTransactionConfig({txConfig:t,isWrite:!0,method:null,isParent:this.contractParam.isParent}).then((function(e){return r.logger.log("process write config"),t.returnTransaction?e:r.write(e)}))},t.prototype.readTransaction=function(t){void 0===t&&(t={}),this.validateTxOption_(t);var e=this.contractParam.isParent,r=this.getClient(e);return r.logger.log("process read"),this.createTransactionConfig({txConfig:t,isWrite:!0,method:null,isParent:this.contractParam.isParent}).then((function(e){return r.logger.log("write tx config created"),t.returnTransaction?e:r.read(e)}))},t.prototype.validateTxOption_=function(t){("object"!=typeof t||Array.isArray(t))&&new m(i.TransactionOptionNotObject).throw()},t.prototype.processRead=function(t,e){var r=this;return void 0===e&&(e={}),this.validateTxOption_(e),this.client.logger.log("process read"),this.createTransactionConfig({txConfig:e,isWrite:!1,method:t,isParent:this.contractParam.isParent}).then((function(n){return r.client.logger.log("read tx config created"),e.returnTransaction?b(n,{data:t.encodeABI(),to:r.contract_.address}):t.read(n)}))},t.prototype.getClient=function(t){return t?this.client.parent:this.client.child},t.prototype.getContract_=function(t){var e=t.isParent,r=t.tokenAddress,n=t.abi;return this.getClient(e).getContract(r,n)},Object.defineProperty(t.prototype,"parentDefaultConfig",{get:function(){return this.client.config.parent.defaultConfig},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"childDefaultConfig",{get:function(){return this.client.config.child.defaultConfig},enumerable:!1,configurable:!0}),t.prototype.createTransactionConfig=function(t){var e=this,r=t.txConfig,n=t.method,o=t.isParent,a=t.isWrite,c=o?this.parentDefaultConfig:this.childDefaultConfig;r=b(c,r||{});var s=o?this.client.parent:this.client.child;s.logger.log("txConfig",r,"onRoot",o,"isWrite",a);return a?this.getChainId().then((function(t){var a,c=r.maxFeePerGas,u=r.maxPriorityFeePerGas,f=e.client.isEIP1559Supported(t),h=c||u;return r.chainId=r.chainId||t,!f&&h&&s.logger.error(i.EIP1559NotSupported,o).throw(),Promise.all([r.gasLimit?r.gasLimit:(a={from:r.from,value:r.value},n?n.estimateGas(a):s.estimateGas(a)),r.nonce?r.nonce:s.getTransactionCount(r.from,"pending")]).then((function(t){var e=t[0],n=t[1];return s.logger.log("options filled"),r.gasLimit=Number(e),r.nonce=n,r}))})):W(r)},t.prototype.transferERC20=function(t,e,r){var n=this;return this.getContract().then((function(o){var i=o.method("transfer",t,H.toHex(e));return n.processWrite(i,r)}))},t.prototype.transferERC721=function(t,e,r,n){var o=this;return this.getContract().then((function(i){var a=i.method("transferFrom",t,e,r);return o.processWrite(a,n)}))},t.prototype.checkForNonNative=function(t){this.contractParam.address===z&&this.client.logger.error(i.AllowedOnNonNativeTokens,t).throw()},t.prototype.checkForRoot=function(t){this.contractParam.isParent||this.client.logger.error(i.AllowedOnRoot,t).throw()},t.prototype.checkForChild=function(t){this.contractParam.isParent&&this.client.logger.error(i.AllowedOnChild,t).throw()},t.prototype.transferERC1155=function(t,e){var r=this;return this.getContract().then((function(n){var o=n.method("safeTransferFrom",t.from,t.to,H.toHex(t.tokenId),H.toHex(t.amount),t.data||"0x");return r.processWrite(o,e)}))},t}(),J=function(){function t(t){this.httpRequest=new M(t)}return t.prototype.getABI=function(t,e,r,n){var o="".concat(t,"/").concat(e,"/artifacts/").concat(r,"/").concat(n,".json");return this.httpRequest.get(o).then((function(t){return t.abi}))},t.prototype.getAddress=function(t,e){var r="".concat(t,"/").concat(e,"/index.json");return this.httpRequest.get(r)},t}(),X={abiStoreUrl:"https://static.matic.network/network/",hermezBridgeService:"https://bridge-api.public.zkevm-test.net/"},K=function(){function t(t){this.httpRequest=new M(t)}return t.prototype.createUrlForPos=function(t,e){return"".concat("mainnet"===t?"matic":"mumbai").concat(e)},t.prototype.getBlockIncluded=function(t,e){var r=this.createUrlForPos(t,"/block-included/".concat(e));return this.httpRequest.get(r).then((function(t){var e=t.headerBlockNumber,r="0x"===e.slice(0,2)?parseInt(e,16):e;return t.headerBlockNumber=new ct.BN(r),t}))},t.prototype.getProof=function(t,e,r,n){var o=this.createUrlForPos(t,"/fast-merkle-proof?start=".concat(e,"&end=").concat(r,"&number=").concat(n));return this.httpRequest.get(o).then((function(t){return t.proof}))},t.prototype.getMerkleProofForHermez=function(t,e){var r="merkle-proof?net_id=".concat(t,"&deposit_cnt=").concat(e);return this.httpRequest.get(r).then((function(t){return t.proof}))},t.prototype.getBridgeTransactionDetails=function(t,e){var r="bridge?net_id=".concat(t,"&deposit_cnt=").concat(e);return this.httpRequest.get(r).then((function(t){return t.deposit}))},t}(),Q=new function(){};Q.abi=new J(X.abiStoreUrl);var $=function(t){"/"!==t[t.length-1]&&(t+="/"),t+="api/v1/",Q.network=new K(t)},tt=function(t){"/"!==t[t.length-1]&&(t+="/"),Q.hermezNetwork=new K(t)};function et(t,e){return(Array.isArray(e)?e:e.split(".")).reduce((function(t,e){return t&&t[e]}),t)}var rt=function(){function t(){this.client=new D}return t.prototype.isCheckPointed=function(t){return this.exitUtil.isCheckPointed(t)},t.prototype.isDeposited=function(t){var e=this.client,r=new V({address:e.abiManager.getConfig("Matic.GenesisContracts.StateReceiver"),isParent:!1,name:"StateReceiver",bridgeType:"genesis"},e);return r.getContract().then((function(n){return Promise.all([e.parent.getTransactionReceipt(t),r.processRead(n.method("lastStateId"))])})).then((function(t){var r=t[0],n=t[1],o=r.logs.find((function(t){return"0x103fed9db65eac19c4d870f49ab7520fe03b99f1838e5996caf47e9e43308392"===t.topics[0]}));if(!o)throw new Error("StateSynced event not found");var i=e.child.decodeParameters(o.topics[1],["uint256"])[0],a=ct.BN.isBN(i)?i:new ct.BN(i);return new ct.BN(n).gte(a)}))},t}(),nt={},ot=function(){function t(t,e){this.networkName=t,this.version=e}return t.prototype.init=function(){var t=this;return Q.abi.getAddress(this.networkName,this.version).then((function(e){var r;nt[t.networkName]=((r={})[t.version]={address:e,abi:{}},r)}))},t.prototype.getConfig=function(t){return et(nt[this.networkName][this.version].address,t)},t.prototype.getABI=function(t,e){var r=this;void 0===e&&(e="plasma");var n=nt[this.networkName][this.version].abi[e];if(n){var o=n[t];if(o)return W(o)}return Q.abi.getABI(this.networkName,this.version,e,t).then((function(n){return r.setABI(t,e,n),n}))},t.prototype.setABI=function(t,e,r){var n=nt[this.networkName][this.version].abi;n[e]||(n[e]={}),n[e][t]=r},t}(),it=function(){throw new Error("not implemented")},at=function(){function t(){this.client=new D}return t.prototype.isDepositClaimable=function(t){return Promise.all([this.rootChainBridge.networkID(),this.bridgeUtil.getBridgeLogData(t,!0)]).then((function(t){return Q.hermezNetwork.getBridgeTransactionDetails(t[0],t[1].depositCount)})).then((function(t){return t.ready_for_claim}))},t.prototype.isWithdrawExitable=function(t){return Promise.all([this.childChainBridge.networkID(),this.bridgeUtil.getBridgeLogData(t,!1)]).then((function(t){return Q.hermezNetwork.getBridgeTransactionDetails(t[0],t[1].depositCount)})).then((function(t){return t.ready_for_claim}))},t.prototype.isDeposited=function(t){var e=this;return this.bridgeUtil.getBridgeLogData(t,!0).then((function(t){return e.childChainBridge.isClaimed(t.depositCount)}))},t.prototype.isExited=function(t){var e=this;return this.bridgeUtil.getBridgeLogData(t,!1).then((function(t){return e.rootChainBridge.isClaimed(t.depositCount)}))},t}(),ct={converter:H,Web3Client:c,BN:h,UnstoppableDomains:Object},st=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ut=function(t){function e(e,r,n){var o=t.call(this,e,r)||this;return o.getPOSContracts=n,o}return st(e,t),Object.defineProperty(e.prototype,"rootChainManager",{get:function(){return this.getPOSContracts().rootChainManager},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exitUtil",{get:function(){return this.getPOSContracts().exitUtil},enumerable:!1,configurable:!0}),e.prototype.getPredicateAddress=function(){var t=this;return this.predicateAddress?W(this.predicateAddress):this.rootChainManager.method("tokenToType",this.contractParam.address).then((function(t){return t.read()})).then((function(e){if(!e)throw new Error("Invalid Token Type");return t.rootChainManager.method("typeToPredicate",e)})).then((function(t){return t.read()})).then((function(e){return t.predicateAddress=e,e}))},e.prototype.isWithdrawn=function(t,e){var r=this;if(!t)throw new Error("txHash not provided");return this.exitUtil.getExitHash(t,0,e).then((function(t){return r.rootChainManager.isExitProcessed(t)}))},e.prototype.isWithdrawnOnIndex=function(t,e,r){var n=this;if(!t)throw new Error("txHash not provided");return this.exitUtil.getExitHash(t,e,r).then((function(t){return n.rootChainManager.isExitProcessed(t)}))},e.prototype.withdrawExitPOS=function(t,e,r,n){var o=this;return this.exitUtil.buildPayloadForExit(t,e,r).then((function(t){return o.rootChainManager.exit(t,n)}))},e}(V),ft=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ht=function(t){function e(e,r,n,o){return t.call(this,{isParent:r,address:e,name:"ChildERC20",bridgeType:"pos"},n,o)||this}return ft(e,t),e.prototype.getBalance=function(t,e){var r=this;return this.getContract().then((function(n){var o=n.method("balanceOf",t);return r.processRead(o,e)}))},e.prototype.getAllowance=function(t,e){var r=this;void 0===e&&(e={});var n=e.spenderAddress,o=n?W(n):this.getPredicateAddress();return Promise.all([o,this.getContract()]).then((function(n){var o=n[0],i=n[1].method("allowance",t,o);return r.processRead(i,e)}))},e.prototype.approve=function(t,e){var r=this;void 0===e&&(e={});var n=e.spenderAddress;n||this.contractParam.isParent||this.client.logger.error(i.NullSpenderAddress).throw();var o=n?W(n):this.getPredicateAddress();return Promise.all([o,this.getContract()]).then((function(n){var o=n[0],i=n[1].method("approve",o,H.toHex(t));return r.processWrite(i,e)}))},e.prototype.approveMax=function(t){return void 0===t&&(t={}),this.approve(L,t)},e.prototype.deposit=function(t,e,r){this.checkForRoot("deposit");var n=this.client.parent.encodeParameters([H.toHex(t)],["uint256"]);return this.rootChainManager.deposit(e,this.contractParam.address,n,r)},e.prototype.depositEther_=function(t,e,r){var n=this;return void 0===r&&(r={}),this.checkForRoot("depositEther"),r.value=H.toHex(t),this.rootChainManager.method("depositEtherFor",e).then((function(t){return n.processWrite(t,r)}))},e.prototype.withdrawStart=function(t,e){var r=this;return this.checkForChild("withdrawStart"),this.getContract().then((function(n){var o=n.method("withdraw",H.toHex(t));return r.processWrite(o,e)}))},e.prototype.withdrawExit_=function(t,e,r){var n=this;void 0===r&&(r={});var i=r.burnEventSignature?r.burnEventSignature:o.Erc20Transfer;return this.exitUtil.buildPayloadForExit(t,i,e).then((function(t){return n.rootChainManager.exit(t,r)}))},e.prototype.withdrawExit=function(t,e){return this.checkForRoot("withdrawExit"),this.withdrawExit_(t,!1,e)},e.prototype.withdrawExitFaster=function(t,e){return this.checkForRoot("withdrawExitFaster"),this.withdrawExit_(t,!0,e)},e.prototype.isWithdrawExited=function(t){return this.isWithdrawn(t,o.Erc20Transfer)},e.prototype.transfer=function(t,e,r){return this.transferERC20(e,t,r)},e}(ut),pt=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),dt=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},lt=function(t){function e(e,r){return t.call(this,{address:r,name:"RootChainManager",bridgeType:"pos",isParent:!0},e)||this}return pt(e,t),e.prototype.method=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return this.getContract().then((function(r){return r.method.apply(r,dt([t],e,!1))}))},e.prototype.deposit=function(t,e,r,n){var o=this;return this.method("depositFor",t,e,r).then((function(t){return o.processWrite(t,n)}))},e.prototype.exit=function(t,e){var r=this;return this.method("exit",t).then((function(t){return r.processWrite(t,e)}))},e.prototype.isExitProcessed=function(t){var e=this;return this.method("processedExits",t).then((function(t){return e.processRead(t)}))},e}(V),gt=function(){function t(t,e){this.maticClient_=t.child,this.rootChain=e;var r=t.config;this.config=r,this.requestConcurrency=r.requestConcurrency}return t.prototype.getLogIndex_=function(t,e){var r=-1;switch(t){case"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef":case"0xf94915c6d1fd521cee85359239227480c7e8776d7caf1fc3bacad5c269b66a14":r=e.logs.findIndex((function(e){return e.topics[0].toLowerCase()===t.toLowerCase()&&"0x0000000000000000000000000000000000000000000000000000000000000000"===e.topics[2].toLowerCase()}));break;case"0xc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62":case"0x4a39dc06d4c0dbc64b70af90fd698a233a518aa5d07e595d983b8c0526c8f7fb":r=e.logs.findIndex((function(e){return e.topics[0].toLowerCase()===t.toLowerCase()&&"0x0000000000000000000000000000000000000000000000000000000000000000"===e.topics[3].toLowerCase()}));break;default:r=e.logs.findIndex((function(e){return e.topics[0].toLowerCase()===t.toLowerCase()}))}if(r<0)throw new Error("Log not found in receipt");return r},t.prototype.getAllLogIndices_=function(t,e){var r=[];switch(t){case"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef":case"0xf94915c6d1fd521cee85359239227480c7e8776d7caf1fc3bacad5c269b66a14":r=e.logs.reduce((function(e,n,o){return n.topics[0].toLowerCase()===t.toLowerCase()&&"0x0000000000000000000000000000000000000000000000000000000000000000"===n.topics[2].toLowerCase()&&r.push(o),r}),[]);break;case"0xc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62":case"0x4a39dc06d4c0dbc64b70af90fd698a233a518aa5d07e595d983b8c0526c8f7fb":r=e.logs.reduce((function(e,n,o){return n.topics[0].toLowerCase()===t.toLowerCase()&&"0x0000000000000000000000000000000000000000000000000000000000000000"===n.topics[3].toLowerCase()&&r.push(o),r}),[]);break;case"0xf871896b17e9cb7a64941c62c188a4f5c621b86800e3d15452ece01ce56073df":r=e.logs.reduce((function(t,e,n){return"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"===e.topics[0].toLowerCase()&&"0x0000000000000000000000000000000000000000000000000000000000000000"===e.topics[2].toLowerCase()&&r.push(n),r}),[]);break;default:r=e.logs.reduce((function(e,n,o){return n.topics[0].toLowerCase()===t.toLowerCase()&&r.push(o),r}),[])}if(0===r.length)throw new Error("Log not found in receipt");return r},t.prototype.getChainBlockInfo=function(t){return Promise.all([this.rootChain.getLastChildBlock(),this.maticClient_.getTransaction(t)]).then((function(t){return{lastChildBlock:t[0],txBlockNumber:t[1].blockNumber}}))},t.prototype.isCheckPointed_=function(t){return new ct.BN(t.lastChildBlock).gte(new ct.BN(t.txBlockNumber))},t.prototype.isCheckPointed=function(t){var e=this;return this.getChainBlockInfo(t).then((function(t){return e.isCheckPointed_(t)}))},t.prototype.getRootBlockInfo=function(t){var e,r=this;return this.rootChain.findRootBlockFromChild(t).then((function(t){return e=t,r.rootChain.method("headerBlocks",H.toHex(t))})).then((function(t){return t.read()})).then((function(t){return{headerBlockNumber:e,end:t.end.toString(),start:t.start.toString()}}))},t.prototype.getRootBlockInfoFromAPI=function(t){var e=this;return this.maticClient_.logger.log("block info from API 1"),Q.network.getBlockIncluded(this.config.network,t).then((function(t){if(e.maticClient_.logger.log("block info from API 2",t),!(t&&t.start&&t.end&&t.headerBlockNumber))throw Error("Network API Error");return t})).catch((function(r){return e.maticClient_.logger.log("block info from API",r),e.getRootBlockInfo(t)}))},t.prototype.getBlockProof=function(t,e){return S.buildBlockProof(this.maticClient_,parseInt(e.start,10),parseInt(e.end,10),parseInt(t+"",10))},t.prototype.getBlockProofFromAPI=function(t,e){var r=this;return Q.network.getProof(this.config.network,e.start,e.end,t).then((function(t){if(!t)throw Error("Network API Error");return r.maticClient_.logger.log("block proof from API 1"),t})).catch((function(n){return r.getBlockProof(t,e)}))},t.prototype.buildPayloadForExit=function(t,e,r,n){var o,a,c,s,u,f=this;if(void 0===n&&(n=0),r&&!Q.network&&new m(i.ProofAPINotSet).throw(),n<0)throw new Error("Index must not be a negative integer");return this.getChainBlockInfo(t).then((function(e){if(!f.isCheckPointed_(e))throw new Error("Burn transaction has not been checkpointed as yet");return o=e.txBlockNumber,Promise.all([f.maticClient_.getTransactionReceipt(t),f.maticClient_.getBlockWithTransaction(o)])})).then((function(t){return c=t[0],s=t[1],r?f.getRootBlockInfoFromAPI(o):f.getRootBlockInfo(o)})).then((function(t){return a=t,r?f.getBlockProofFromAPI(o,a):f.getBlockProof(o,a)})).then((function(t){return u=t,S.getReceiptProof(c,s,f.maticClient_,f.requestConcurrency)})).then((function(t){if(n>0){var r=f.getAllLogIndices_(e,c);if(n>=r.length)throw new Error("Index is grater than the number of tokens in this transaction");return f.encodePayload_(a.headerBlockNumber.toNumber(),u,o,s.timestamp,Buffer.from(s.transactionsRoot.slice(2),"hex"),Buffer.from(s.receiptsRoot.slice(2),"hex"),S.getReceiptBytes(c),t.parentNodes,t.path,r[n])}var i=f.getLogIndex_(e,c);return f.encodePayload_(a.headerBlockNumber.toNumber(),u,o,s.timestamp,Buffer.from(s.transactionsRoot.slice(2),"hex"),Buffer.from(s.receiptsRoot.slice(2),"hex"),S.getReceiptBytes(c),t.parentNodes,t.path,i)}))},t.prototype.buildMultiplePayloadsForExit=function(t,e,r){var n,o,a,c,s,u=this;return r&&!Q.network&&new m(i.ProofAPINotSet).throw(),this.getChainBlockInfo(t).then((function(e){if(!u.isCheckPointed_(e))throw new Error("Burn transaction has not been checkpointed as yet");return n=e.txBlockNumber,Promise.all([u.maticClient_.getTransactionReceipt(t),u.maticClient_.getBlockWithTransaction(n)])})).then((function(t){return a=t[0],c=t[1],r?u.getRootBlockInfoFromAPI(n):u.getRootBlockInfo(n)})).then((function(t){return o=t,r?u.getBlockProofFromAPI(n,o):u.getBlockProof(n,o)})).then((function(t){return s=t,S.getReceiptProof(a,c,u.maticClient_,u.requestConcurrency)})).then((function(t){for(var r=[],i=0,f=u.getAllLogIndices_(e,a);i<f.length;i++){var h=f[i];r.push(u.encodePayload_(o.headerBlockNumber.toNumber(),s,n,c.timestamp,Buffer.from(c.transactionsRoot.slice(2),"hex"),Buffer.from(c.receiptsRoot.slice(2),"hex"),S.getReceiptBytes(a),t.parentNodes,t.path,h))}return r}))},t.prototype.encodePayload_=function(t,e,r,n,o,i,a,c,s,u){return Object(A.bufferToHex)(A.rlp.encode([t,e,r,n,Object(A.bufferToHex)(o),Object(A.bufferToHex)(i),Object(A.bufferToHex)(a),Object(A.bufferToHex)(A.rlp.encode(c)),Object(A.bufferToHex)(Buffer.concat([Buffer.from("00","hex"),s])),u]))},t.prototype.getExitHash=function(t,e,r){var n,o,a,c=this;return Promise.all([this.rootChain.getLastChildBlock(),this.maticClient_.getTransactionReceipt(t)]).then((function(t){return n=t[0],o=t[1],c.maticClient_.getBlockWithTransaction(o.blockNumber)})).then((function(t){return a=t,c.isCheckPointed_({lastChildBlock:n,txBlockNumber:o.blockNumber})||c.maticClient_.logger.error(i.BurnTxNotCheckPointed).throw(),S.getReceiptProof(o,a,c.maticClient_,c.requestConcurrency)})).then((function(t){var n,i=[];(t.path.forEach((function(t){i.push(Buffer.from("0"+(t/16).toString(16),"hex")),i.push(Buffer.from("0"+(t%16).toString(16),"hex"))})),e>0)&&(n=c.getAllLogIndices_(r,o)[e]);return n=c.getLogIndex_(r,o),c.maticClient_.etheriumSha3(o.blockNumber,Object(A.bufferToHex)(Buffer.concat(i)),n)}))},t}(),yt=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),mt=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function c(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,c)}s((n=n.apply(t,e||[])).next())}))},vt=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},wt=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},bt=function(t){function e(e,r){return t.call(this,{address:r,name:"RootChain",isParent:!0},e)||this}return yt(e,t),e.prototype.method=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return this.getContract().then((function(r){return r.method.apply(r,wt([t],e,!1))}))},e.prototype.getLastChildBlock=function(){var t=this;return this.method("getLastChildBlock").then((function(e){return e.read({},t.client.config.rootChainDefaultBlock||"safe")}))},e.prototype.findRootBlockFromChild=function(t){return mt(this,void 0,void 0,(function(){var e,r,n,o,i,a,c,s,u,f,h;return vt(this,(function(p){switch(p.label){case 0:return e=new ct.BN(1),r=new ct.BN(2),n=new ct.BN(1e4),t=new ct.BN(t),o=e,[4,this.method("currentHeaderBlock")];case 1:return[4,p.sent().read()];case 2:i=p.sent(),a=new ct.BN(i).div(n),p.label=3;case 3:return o.lte(a)?o.eq(a)?(c=o,[3,6]):(s=o.add(a).div(r),[4,this.method("headerBlocks",s.mul(n).toString())]):[3,6];case 4:return[4,p.sent().read()];case 5:return u=p.sent(),f=new ct.BN(u.start),h=new ct.BN(u.end),f.lte(t)&&t.lte(h)?(c=s,[3,6]):(f.gt(t)?a=s.sub(e):h.lt(t)&&(o=s.add(e)),[3,3]);case 6:return[2,c.mul(n)]}}))}))},e}(V),Pt=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ct=function(t){function e(e,r,n,o){return t.call(this,{isParent:r,address:e,name:"ChildERC721",bridgeType:"pos"},n,o)||this}return Pt(e,t),e.prototype.validateMany_=function(t){if(t.length>20)throw new Error("can not process more than 20 tokens");return t.map((function(t){return H.toHex(t)}))},e.prototype.getTokensCount=function(t,e){var r=this;return this.getContract().then((function(n){var o=n.method("balanceOf",t);return r.processRead(o,e)})).then((function(t){return Number(t)}))},e.prototype.getTokenIdAtIndexForUser=function(t,e,r){var n=this;return this.getContract().then((function(o){var i=o.method("tokenOfOwnerByIndex",e,t);return n.processRead(i,r)}))},e.prototype.getAllTokens=function(t,e){var r=this;return void 0===e&&(e=1/0),this.getTokensCount(t).then((function(n){(n=Number(n))>e&&(n=e);for(var o=[],i=0;i<n;i++)o.push(r.getTokenIdAtIndexForUser(i,t));return Promise.all(o)}))},e.prototype.isApproved=function(t,e){var r=this;return this.checkForRoot("isApproved"),this.getContract().then((function(n){var o=n.method("getApproved",t);return Promise.all([r.processRead(o,e),r.getPredicateAddress()]).then((function(t){return t[0]===t[1]}))}))},e.prototype.isApprovedAll=function(t,e){var r=this;return this.checkForRoot("isApprovedAll"),Promise.all([this.getContract(),this.getPredicateAddress()]).then((function(n){var o=n[0],i=n[1],a=o.method("isApprovedForAll",t,i);return r.processRead(a,e)}))},e.prototype.approve=function(t,e){var r=this;return this.checkForRoot("approve"),Promise.all([this.getContract(),this.getPredicateAddress()]).then((function(n){var o=n[0],i=n[1],a=o.method("approve",i,H.toHex(t));return r.processWrite(a,e)}))},e.prototype.approveAll=function(t){var e=this;return this.checkForRoot("approveAll"),Promise.all([this.getContract(),this.getPredicateAddress()]).then((function(r){var n=r[0],o=r[1],i=n.method("setApprovalForAll",o,!0);return e.processWrite(i,t)}))},e.prototype.deposit=function(t,e,r){this.checkForRoot("deposit");var n=this.client.parent.encodeParameters([H.toHex(t)],["uint256"]);return this.rootChainManager.deposit(e,this.contractParam.address,n,r)},e.prototype.depositMany=function(t,e,r){this.checkForRoot("depositMany");var n=this.validateMany_(t),o=this.client.parent.encodeParameters([n],["uint256[]"]);return this.rootChainManager.deposit(e,this.contractParam.address,o,r)},e.prototype.withdrawStart=function(t,e){var r=this;return this.checkForChild("withdrawStart"),this.getContract().then((function(n){var o=n.method("withdraw",H.toHex(t));return r.processWrite(o,e)}))},e.prototype.withdrawStartWithMetaData=function(t,e){var r=this;return this.checkForChild("withdrawStartWithMetaData"),this.getContract().then((function(n){var o=n.method("withdrawWithMetadata",H.toHex(t));return r.processWrite(o,e)}))},e.prototype.withdrawStartMany=function(t,e){var r=this;this.checkForChild("withdrawStartMany");var n=this.validateMany_(t);return this.getContract().then((function(t){var o=t.method("withdrawBatch",n);return r.processWrite(o,e)}))},e.prototype.withdrawExit=function(t,e){var r=this;return this.checkForRoot("withdrawExit"),this.exitUtil.buildPayloadForExit(t,o.Erc721Transfer,!1).then((function(t){return r.rootChainManager.exit(t,e)}))},e.prototype.withdrawExitOnIndex=function(t,e,r){var n=this;return this.checkForRoot("withdrawExit"),this.exitUtil.buildPayloadForExit(t,o.Erc721Transfer,!1,e).then((function(t){return n.rootChainManager.exit(t,r)}))},e.prototype.withdrawExitFaster=function(t,e){var r=this;return this.checkForRoot("withdrawExitFaster"),this.exitUtil.buildPayloadForExit(t,o.Erc721Transfer,!0).then((function(t){return r.rootChainManager.exit(t,e)}))},e.prototype.isWithdrawExited=function(t){return this.isWithdrawn(t,o.Erc721Transfer)},e.prototype.isWithdrawExitedMany=function(t){return this.isWithdrawn(t,o.Erc721BatchTransfer)},e.prototype.isWithdrawExitedOnIndex=function(t,e){return this.isWithdrawnOnIndex(t,e,o.Erc721Transfer)},e.prototype.transfer=function(t,e,r,n){return this.transferERC721(e,r,t,n)},e}(ut),xt=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),_t=function(t){function e(e,r,n,o){return t.call(this,{isParent:r,address:e,name:"ChildERC1155",bridgeType:"pos"},n,o)||this}return xt(e,t),Object.defineProperty(e.prototype,"addressConfig",{get:function(){return this.client.config.erc1155||{}},enumerable:!1,configurable:!0}),e.prototype.getAddress_=function(t){var e=this.addressConfig;return e[t]?W(e[t]):this.client.getConfig(t)},e.prototype.getBalance=function(t,e,r){var n=this;return this.getContract().then((function(o){var i=o.method("balanceOf",t,H.toHex(e));return n.processRead(i,r)}))},e.prototype.isApprovedAll=function(t,e){var r=this;return this.checkForRoot("isApprovedAll"),Promise.all([this.getContract(),this.getPredicateAddress()]).then((function(n){var o=n[0],i=n[1],a=o.method("isApprovedForAll",t,i);return r.processRead(a,e)}))},e.prototype.approveAll_=function(t,e){var r=this;return this.checkForRoot("approve"),Promise.all([this.getContract(),t]).then((function(t){var n=t[0],o=t[1],i=n.method("setApprovalForAll",o,!0);return r.processWrite(i,e)}))},e.prototype.approveAll=function(t){return this.checkForRoot("approve"),this.approveAll_(this.getPredicateAddress(),t)},e.prototype.approveAllForMintable=function(t){this.checkForRoot("approveForMintable");return this.approveAll_(this.getAddress_("Main.POSContracts.MintableERC1155PredicateProxy"),t)},e.prototype.deposit=function(t,e){return this.checkForRoot("deposit"),this.depositMany({amounts:[t.amount],tokenIds:[t.tokenId],userAddress:t.userAddress,data:t.data},e)},e.prototype.depositMany=function(t,e){this.checkForRoot("depositMany");var r=t.tokenIds,n=t.amounts,o=t.data,i=t.userAddress,a=H.toHex(0),c=this.client.parent.encodeParameters([r.map((function(t){return H.toHex(t)})),n.map((function(t){return H.toHex(t)})),o||a],["uint256[]","uint256[]","bytes"]);return this.rootChainManager.deposit(i,this.contractParam.address,c,e)},e.prototype.withdrawStart=function(t,e,r){var n=this;return this.checkForChild("withdrawStart"),this.getContract().then((function(o){var i=o.method("withdrawSingle",H.toHex(t),H.toHex(e));return n.processWrite(i,r)}))},e.prototype.withdrawStartMany=function(t,e,r){var n=this;this.checkForChild("withdrawStartMany");var o=t.map((function(t){return H.toHex(t)})),i=e.map((function(t){return H.toHex(t)}));return this.getContract().then((function(t){var e=t.method("withdrawBatch",o,i);return n.processWrite(e,r)}))},e.prototype.withdrawExit=function(t,e){return this.checkForRoot("withdrawExit"),this.withdrawExitPOS(t,o.Erc1155Transfer,!1,e)},e.prototype.withdrawExitFaster=function(t,e){return this.checkForRoot("withdrawExitFaster"),this.withdrawExitPOS(t,o.Erc1155Transfer,!0,e)},e.prototype.withdrawExitMany=function(t,e){return this.checkForRoot("withdrawExitMany"),this.withdrawExitPOS(t,o.Erc1155BatchTransfer,!1,e)},e.prototype.withdrawExitFasterMany=function(t,e){return this.checkForRoot("withdrawExitFasterMany"),this.withdrawExitPOS(t,o.Erc1155BatchTransfer,!0,e)},e.prototype.isWithdrawExited=function(t){return this.isWithdrawn(t,o.Erc1155Transfer)},e.prototype.isWithdrawExitedMany=function(t){return this.isWithdrawn(t,o.Erc1155BatchTransfer)},e.prototype.transfer=function(t,e){return this.transferERC1155(t,e)},e}(ut),kt=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Bt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return kt(e,t),e.prototype.init=function(t){var e=this,r=this.client;return r.init(t).then((function(n){var o=r.mainPOSContracts;r.config=t=Object.assign({rootChainManager:o.RootChainManagerProxy,rootChain:r.mainPlasmaContracts.RootChainProxy},t),e.rootChainManager=new lt(e.client,t.rootChainManager);var i=new bt(e.client,t.rootChain);return e.exitUtil=new gt(e.client,i),e}))},e.prototype.erc20=function(t,e){return new ht(t,e,this.client,this.getContracts_.bind(this))},e.prototype.erc721=function(t,e){return new Ct(t,e,this.client,this.getContracts_.bind(this))},e.prototype.erc1155=function(t,e){return new _t(t,e,this.client,this.getContracts_.bind(this))},e.prototype.depositEther=function(t,e,r){return new ht("",!0,this.client,this.getContracts_.bind(this)).depositEther_(t,e,r)},e.prototype.getContracts_=function(){return{exitUtil:this.exitUtil,rootChainManager:this.rootChainManager}},e}(rt),At={utils:ct,use:d,POSClient:Bt},Et=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ot=function(t){function e(e,r,n){var o=t.call(this,e,r)||this;return o.getHermezContracts=n,o}return Et(e,t),Object.defineProperty(e.prototype,"parentBridge",{get:function(){return this.getHermezContracts().parentBridge},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"childBridge",{get:function(){return this.getHermezContracts().childBridge},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bridgeUtil",{get:function(){return this.getHermezContracts().bridgeUtil},enumerable:!1,configurable:!0}),e}(V),Tt=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Rt=function(t){function e(e,r,n,o){return t.call(this,{isParent:r,address:e,name:"ERC20",bridgeType:"zkevm"},n,o)||this}return Tt(e,t),e.prototype.getBridgeAddress=function(){return(this.contractParam.isParent?this.parentBridge:this.childBridge).contractAddress},e.prototype.isEtherToken=function(){return this.contractParam.address===z},e.prototype.getBalance=function(t,e){var r=this;return this.isEtherToken()?(this.contractParam.isParent?this.client.parent:this.client.child).getBalance(t):this.getContract().then((function(n){var o=n.method("balanceOf",t);return r.processRead(o,e)}))},e.prototype.isApprovalNeeded=function(){return!this.isEtherToken()&&(this.contractParam.isParent?this.parentBridge:this.childBridge).getOriginTokenInfo(this.contractParam.address).then((function(t){return t[1]===z}))},e.prototype.getAllowance=function(t,e){var r=this;void 0===e&&(e={}),this.checkForNonNative("getAllowance");var n=e.spenderAddress?e.spenderAddress:this.getBridgeAddress();return this.getContract().then((function(o){var i=o.method("allowance",t,n);return r.processRead(i,e)}))},e.prototype.approve=function(t,e){var r=this;void 0===e&&(e={}),this.checkForNonNative("approve");var n=e.spenderAddress?e.spenderAddress:this.getBridgeAddress();return this.getContract().then((function(o){var i=o.method("approve",n,H.toHex(t));return r.processWrite(i,e)}))},e.prototype.approveMax=function(t){return void 0===t&&(t={}),this.checkForNonNative("approveMax"),this.approve(L,t)},e.prototype.deposit=function(t,e,r){var n=this;void 0===r&&(r={}),this.checkForRoot("deposit");var o=r.permitData||"0x",i=this.client.parent.encodeParameters([H.toHex(t)],["uint256"]);return this.isEtherToken()&&(r.value=H.toHex(t)),this.childBridge.networkID().then((function(t){return n.parentBridge.bridgeAsset(n.contractParam.address,t,e,i,o,r)}))},e.prototype.depositWithPermit=function(t,e,r){var n=this;void 0===r&&(r={}),this.checkForRoot("deposit"),this.checkForNonNative("depositWithPermit");var o=this.client.parent.encodeParameters([H.toHex(t)],["uint256"]);return this.getPermitData(o,r).then((function(t){return n.childBridge.networkID().then((function(i){return n.parentBridge.bridgeAsset(n.contractParam.address,i,e,o,t,r)}))}))},e.prototype.depositClaim=function(t,e){var r=this;return this.checkForChild("depositClaim"),this.parentBridge.networkID().then((function(e){return r.bridgeUtil.buildPayloadForClaim(t,!0,e)})).then((function(t){return r.childBridge.claimAsset(t.smtProof,t.index,t.mainnetExitRoot,t.rollupExitRoot,t.originNetwork,t.originTokenAddress,t.destinationNetwork,t.destinationAddress,t.amount,t.metadata,e)}))},e.prototype.withdraw=function(t,e,r){var n=this;void 0===r&&(r={}),this.checkForChild("withdraw");var o=r.permitData||"0x",i=this.client.parent.encodeParameters([H.toHex(t)],["uint256"]);return this.isEtherToken()&&(r.value=H.toHex(t)),this.parentBridge.networkID().then((function(t){return n.childBridge.bridgeAsset(n.contractParam.address,t,e,i,o,r)}))},e.prototype.withdrawWithPermit=function(t,e,r){var n=this;void 0===r&&(r={}),this.checkForChild("withdraw");var o=this.client.parent.encodeParameters([H.toHex(t)],["uint256"]);return this.getPermitData(o,r).then((function(t){return n.parentBridge.networkID().then((function(i){return n.childBridge.bridgeAsset(n.contractParam.address,i,e,o,t,r)}))}))},e.prototype.withdrawExit=function(t,e){var r=this;return this.checkForRoot("withdrawExit"),this.childBridge.networkID().then((function(e){return r.bridgeUtil.buildPayloadForClaim(t,!1,e)})).then((function(t){return r.parentBridge.claimAsset(t.smtProof,t.index,t.mainnetExitRoot,t.rollupExitRoot,t.originNetwork,t.originTokenAddress,t.destinationNetwork,t.destinationAddress,t.amount,t.metadata,e)}))},e.prototype.transfer=function(t,e,r){return this.transferERC20(e,t,r)},e.prototype.getPermit=function(){var t,e=this;return this.getContract().then((function(r){var n=(t=r).method("PERMIT_TYPEHASH");return e.processRead(n)})).then((function(r){switch(r){case q:return C.DAI;case G:var n=t.method("DOMAIN_TYPEHASH"),o=t.method("EIP712DOMAIN_HASH");return U([e.processRead(n),e.processRead(o)]).then((function(t){switch(t){case Z:return C.EIP_2612;case Y:return C.UNISWAP;default:return Promise.reject(new Error("Unsupported domain typehash: ".concat(t)))}}));default:return Promise.reject(new Error("Unsupported permit typehash: ".concat(r)))}}))},e.prototype.getTypedData_=function(t,e,r,n,o,i,a){var c={types:{EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],Permit:[]},primaryType:"Permit",domain:{name:n,version:"1",chainId:r,verifyingContract:this.contractParam.address},message:{}};switch(t){case C.DAI:c.types.Permit=[{name:"holder",type:"address"},{name:"spender",type:"address"},{name:"nonce",type:"uint256"},{name:"expiry",type:"uint256"},{name:"allowed",type:"bool"}],c.message={holder:e,spender:i,nonce:o,expiry:L,allowed:!0};case C.EIP_2612:case C.UNISWAP:t===C.UNISWAP&&(c.types.EIP712Domain=[{name:"name",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],delete c.domain.version),c.types.Permit=[{name:"owner",type:"address"},{name:"spender",type:"address"},{name:"value",type:"uint256"},{name:"nonce",type:"uint256"},{name:"deadline",type:"uint256"}],c.message={owner:e,spender:i,value:a,nonce:o,deadline:L}}return c},e.prototype.getSignatureParameters_=function(t,e){if(!Object(A.isHexString)(e))throw new Error('Given value "'.concat(e,'" is not a valid hex string.'));"0x"!==e.slice(0,2)&&(e="0x".concat(e));var r=e.slice(0,66),n="0x".concat(e.slice(66,130)),o=t.hexToNumber("0x".concat(e.slice(130,132)));return[27,28].includes(o)||(o+=27),{r:r,s:n,v:o}},e.prototype.encodePermitFunctionData_=function(t,e,r,n,o,i,a){var c,s=r.r,u=r.s,f=r.v;switch(e){case C.DAI:c=t.method("permit",o,n,i,L,!0,f,s,u);break;case C.EIP_2612:case C.UNISWAP:c=t.method("permit",o,n,a,L,f,s,u)}return c.encodeABI()},e.prototype.getPermitData_=function(t,e){var r,n,o,i,a,c=this,s=this.client.parent.encodeParameters([H.toHex(t)],["uint256"]),u=this.contractParam.isParent?this.client.parent:this.client.child;return Promise.all(["WEB3"===u.name?u.getAccountsUsingRPC_():u.getAccounts(),this.getContract(),u.getChainId(),this.getPermit()]).then((function(t){r=t[0][0],i=t[1],n=t[2],o=t[3];var e=i.method("name"),a=i.method("nonces",r);return Promise.all([c.processRead(e),c.processRead(a)])})).then((function(t){var i=t[0];return a=t[1],c.getTypedData_(o,r,n,i,a,e,s)})).then((function(t){return u.signTypedData(r,t)})).then((function(t){var n=c.getSignatureParameters_(u,t);return c.encodePermitFunctionData_(i,o,n,e,r,a,s)}))},e.prototype.getPermitData=function(t,e){void 0===e&&(e={}),this.checkForNonNative("getPermitData");var r=e.spenderAddress?e.spenderAddress:this.getBridgeAddress();return this.getPermitData_(t,r)},e}(Ot),It=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Nt=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},St=function(t){function e(e,r,n){return t.call(this,{address:r,name:"PolygonZkEVMBridge",bridgeType:"zkevm",isParent:n},e)||this}return It(e,t),e.prototype.method=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return this.getContract().then((function(r){return r.method.apply(r,Nt([t],e,!1))}))},e.prototype.bridgeAsset=function(t,e,r,n,o,i){var a=this;return void 0===o&&(o="0x"),this.method("bridgeAsset",t,e,r,H.toHex(n),o).then((function(t){return a.processWrite(t,i)}))},e.prototype.claimAsset=function(t,e,r,n,o,i,a,c,s,u,f){var h=this;return this.method("claimAsset",t,e,r,n,o,i,a,c,s,u).then((function(t){return h.processWrite(t,f)}))},e.prototype.getMappedTokenInfo=function(t,e){var r=this;return this.method("getTokenWrappedAddress",t,e).then((function(t){return r.processRead(t)}))},e.prototype.isClaimed=function(t){var e=this;return this.method("isClaimed",t).then((function(t){return e.processRead(t)}))},e.prototype.precalculatedMappedTokenInfo=function(t,e){var r=this;return this.method("precalculatedWrapperAddress",t,e).then((function(t){return r.processRead(t)}))},e.prototype.getOriginTokenInfo=function(t){var e=this;return this.method("wrappedTokenToTokenInfo",t).then((function(t){return e.processRead(t)}))},e.prototype.networkID=function(){var t=this;return this.networkID_?W(this.networkID_):this.method("networkID").then((function(e){return t.processRead(e)}))},e}(V),jt=function(){function t(t){this.BRIDGE_TOPIC="0x501781209a1f8899323b96b4ef08b168df93e0a90c673d1e4cce39366cb62f9b",this.client_=t}return t.prototype.decodedBridgeData_=function(t,e){var r=e?this.client_.parent:this.client_.child;return this.client_.getABI("PolygonZkEVMBridge","zkevm").then((function(e){var n=e.filter((function(t){return"BridgeEvent"===t.name}));if(!n.length)throw new Error("Data not decoded");var o=r.decodeParameters(t,n[0].inputs);return{leafType:o[0],originNetwork:o[1],originTokenAddress:o[2],destinationNetwork:o[3],destinationAddress:o[4],amount:o[5],metadata:o[6]||"0x",depositCount:o[7]}}))},t.prototype.getBridgeLogData_=function(t,e){var r=this;return(e?this.client_.parent:this.client_.child).getTransactionReceipt(t).then((function(t){var n=t.logs.filter((function(t){return t.topics[0].toLowerCase()===r.BRIDGE_TOPIC}));if(!n.length)throw new Error("Log not found in receipt");var o=n[0].data;return r.decodedBridgeData_(o,e)}))},t.prototype.getProof_=function(t,e){return Q.hermezNetwork.getMerkleProofForHermez(t,e).then((function(t){return t})).catch((function(t){throw new Error("Error in creating proof")}))},t.prototype.getBridgeLogData=function(t,e){return this.getBridgeLogData_(t,e)},t.prototype.buildPayloadForClaim=function(t,e,r){var n=this;return this.getBridgeLogData_(t,e).then((function(t){var e=t.originNetwork,o=t.originTokenAddress,i=t.destinationNetwork,a=t.destinationAddress,c=t.amount,s=t.metadata,u=t.depositCount;return n.getProof_(r,u).then((function(t){var r={};return r.smtProof=t.merkle_proof,r.index=u,r.mainnetExitRoot=t.main_exit_root,r.rollupExitRoot=t.rollup_exit_root,r.originNetwork=e,r.originTokenAddress=o,r.destinationNetwork=i,r.destinationAddress=a,r.amount=c,r.metadata=s,r}))}))},t}(),Mt=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mt(e,t),e.prototype.init=function(t){var e=this,r=this.client;return r.init(t).then((function(n){var o=r.mainHermezContracts,i=r.hermezContracts;return r.config=t=Object.assign({parentBridge:o.PolygonZkEVMBridgeProxy,childBridge:i.PolygonZkEVMBridge},t),e.rootChainBridge=new St(e.client,t.parentBridge,!0),e.childChainBridge=new St(e.client,t.childBridge,!1),e.bridgeUtil=new jt(e.client),Q.hermezNetwork||("/"!==X.hermezBridgeService[X.hermezBridgeService.length-1]&&(X.hermezBridgeService+="/"),Q.hermezNetwork=new K(X.hermezBridgeService)),e}))},e.prototype.erc20=function(t,e){return new Rt(t,e,this.client,this.getContracts_.bind(this))},e.prototype.getContracts_=function(){return{parentBridge:this.rootChainBridge,childBridge:this.childChainBridge,bridgeUtil:this.bridgeUtil}},e}(at);e.default=At}]);
//# sourceMappingURL=matic.node.min.js.map