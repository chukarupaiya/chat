{"version":3,"file":"cli.js","sourceRoot":"","sources":["../src/cli.ts"],"names":[],"mappings":";;;;;;AAAA,kDAAyC;AAEzC,0DAAkC;AAClC,mCAMiB;AAEjB;;;;;;GAMG;AACH,SAAgB,GAAG,CAAC,IAAc,EAAE,QAAa;IAC/C,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IAC9B,oEAAoE;IACpE,IAAA,eAAK,EAAC,OAAO,CAAC;SACX,UAAU,CAAC,SAAS,CAAC;SACrB,KAAK,CAAC,+BAA+B,CAAC;SAEtC,OAAO,CAAC,SAAS,EAAE,sDAAsD,CAAC;SAC1E,OAAO,CACN,+BAA+B,EAC/B,iEAAiE,CAClE;SACA,OAAO,CACN,iCAAiC,EACjC,6CAA6C,CAC9C;SACA,OAAO,CACN,4CAA4C,EAC5C,2CAA2C,CAC5C;SACA,OAAO,CAAC,iBAAiB,EAAE,uCAAuC,CAAC;SACnE,OAAO,CAAC,yBAAyB,EAAE,uCAAuC,CAAC;SAC3E,OAAO,CACN,iCAAiC,EACjC,gGAAgG,CACjG;SAEA,OAAO,CAAC,QAAQ,CAAC;SAEjB,MAAM,CAAC,eAAe,EAAE,kBAAQ,CAAC,aAAa,CAAC;SAE/C,MAAM,CAAC,kBAAkB,EAAE,kBAAQ,CAAC,gBAAgB,CAAC;SAErD,MAAM,EAAE;QAET,gEAAgE;QAChE,+EAA+E;QAC/E,0FAA0F;SACzF,UAAU,CACT,CAAC,CAAC,SAAoB,EAAE,aAA+B,EAAE,EAAE;QACzD,IAAA,mBAAW,EAAC,IAAA,kBAAU,GAAE,EAAE,OAAO,EAAE,SAAS,EAAE,aAAa,CAAC,CAAC;QAC7D,IAAA,sBAAc,EAAC,SAAS,CAAC,CAAC;QAC1B,IAAA,sBAAc,EAAC,SAAS,CAAC,CAAC;IAC5B,CAAC,CAAQ,EACT,IAAI,CACL;SAEA,IAAI,CAAC,CAAC,GAAW,EAAE,GAAU,EAAE,MAAM,EAAE,EAAE;QACxC,IAAA,gBAAQ,EAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QACnB,OAAO,CAAC,QAAQ,GAAG,CAAC,CAAC;IACvB,CAAC,CAAC;SAED,aAAa,CAAC,CAAC,EAAE,wCAAwC,CAAC;SAE1D,IAAI,EAAE;SACN,KAAK,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC;AAC7B,CAAC;AAxDD,kBAwDC","sourcesContent":["import yargs, { Arguments } from 'yargs';\nimport yargsType from 'yargs/yargs';\nimport builders from './builders';\nimport {\n  applyConfig,\n  loadConfig,\n  sanitizeInputs,\n  setSnapGlobals,\n  logError,\n} from './utils';\n\n/**\n * The main CLI entry point function. This processes the command line args, and\n * runs the appropriate function.\n *\n * @param argv - The raw command line arguments, i.e., `process.argv`.\n * @param commands - The list of commands to use.\n */\nexport function cli(argv: string[], commands: any): void {\n  const rawArgv = argv.slice(2);\n  // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n  yargs(rawArgv)\n    .scriptName('mm-snap')\n    .usage('Usage: $0 <command> [options]')\n\n    .example('$0 init', `\\tInitialize a snap project in the current directory`)\n    .example(\n      '$0 init --template javascript',\n      `\\tInitialize a snap JavaScript project in the current directory`,\n    )\n    .example(\n      '$0 build -s src/index.js -d out',\n      `\\tBuild 'src/index.js' as './out/bundle.js'`,\n    )\n    .example(\n      '$0 build -s src/index.js -d out -n snap.js',\n      `\\tBuild 'src/index.js' as './out/snap.js'`,\n    )\n    .example('$0 serve -r out', `\\tServe files in './out' on port 8080`)\n    .example('$0 serve -r out -p 9000', `\\tServe files in './out' on port 9000`)\n    .example(\n      '$0 watch -s src/index.js -d out',\n      `\\tRebuild './out/bundle.js' on changes to files in 'src/index.js' parent and child directories`,\n    )\n\n    .command(commands)\n\n    .option('verboseErrors', builders.verboseErrors)\n\n    .option('suppressWarnings', builders.suppressWarnings)\n\n    .strict()\n\n    // Typecast: The @types/yargs type for .middleware is incorrect.\n    // yargs middleware functions receive the yargs instance as a second parameter.\n    // ref: https://yargs.js.org/docs/#api-reference-middlewarecallbacks-applybeforevalidation\n    .middleware(\n      ((yargsArgv: Arguments, yargsInstance: typeof yargsType) => {\n        applyConfig(loadConfig(), rawArgv, yargsArgv, yargsInstance);\n        setSnapGlobals(yargsArgv);\n        sanitizeInputs(yargsArgv);\n      }) as any,\n      true,\n    )\n\n    .fail((msg: string, err: Error, _yargs) => {\n      logError(msg, err);\n      process.exitCode = 1;\n    })\n\n    .demandCommand(1, 'You must specify at least one command.')\n\n    .help()\n    .alias('help', 'h').argv;\n}\n"]}